<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>StudyBuddy AI - Ultimate Hub</title>

<style>
/* =========================
   RESET
========================= */
* { box-sizing: border-box; margin: 0; padding: 0; font-family: Inter, Arial, sans-serif; }
button { cursor: pointer; border: none; }
a { color: inherit; text-decoration: none; }
:root{
  --bg:#0b1225;
  --panel:#111a33;
  --panel2:#1b2750;
  --text:#ffffff;
  --muted:#b7c0ff;
  --btn:#2563eb;
  --btn2:#10a37f;
  --danger:#ef4444;
  --border:rgba(255,255,255,0.12);
  --card:#0f1833;
  --bot:#1f2937;
  --user:#2563eb;
}
.light{
  --bg:#f3f4f6;
  --panel:#ffffff;
  --panel2:#ffffff;
  --text:#111827;
  --muted:#4b5563;
  --btn:#2563eb;
  --btn2:#10a37f;
  --danger:#ef4444;
  --border:rgba(0,0,0,0.12);
  --card:#ffffff;
  --bot:#e5e7eb;
  --user:#2563eb;
}

body{
  height:100vh;
  display:flex;
  background:var(--bg);
  color:var(--text);
  overflow:hidden;
}

/* =========================
   SIDEBAR (ChatGPT Clone)
========================= */
.sidebar{
  width:280px;
  background:linear-gradient(180deg, #202123, #0f1115);
  color:#fff;
  display:flex;
  flex-direction:column;
  border-right:1px solid #2a2a2a;
}
.light .sidebar{
  background:linear-gradient(180deg, #ffffff, #f3f4f6);
  color:#111;
  border-right:1px solid rgba(0,0,0,0.12);
}
.sb-head{
  padding:14px 14px;
  font-weight:800;
  font-size:16px;
  border-bottom:1px solid rgba(255,255,255,0.1);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.light .sb-head{ border-bottom:1px solid rgba(0,0,0,0.08); }
.sb-head small{ opacity:0.7; font-weight:600; }

.sb-actions{
  display:flex;
  gap:8px;
  padding:12px 12px;
}
.sb-actions button{
  flex:1;
  padding:10px;
  border-radius:12px;
  background:rgba(255,255,255,0.08);
  color:#fff;
}
.light .sb-actions button{
  background:rgba(0,0,0,0.06);
  color:#111;
}
.sb-actions button:hover{ transform: translateY(-1px); }

.chatlist{
  flex:1;
  overflow:auto;
  padding:6px 10px 12px;
}
.chatitem{
  width:100%;
  padding:10px 12px;
  border-radius:12px;
  margin:6px 0;
  background:rgba(255,255,255,0.06);
  color:#fff;
  text-align:left;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
}
.light .chatitem{
  background:rgba(0,0,0,0.06);
  color:#111;
}
.chatitem:hover{ background:rgba(255,255,255,0.12); }
.light .chatitem:hover{ background:rgba(0,0,0,0.1); }
.chatitem span{ opacity:0.85; font-size:13px; }
.chatitem b{ font-size:13px; }

.sb-footer{
  padding:12px;
  border-top:1px solid rgba(255,255,255,0.1);
  font-size:12px;
  opacity:0.85;
}
.light .sb-footer{ border-top:1px solid rgba(0,0,0,0.08); }

/* =========================
   MAIN AREA
========================= */
.main{
  flex:1;
  display:flex;
  flex-direction:column;
  height:100vh;
}

.topbar{
  padding:12px 14px;
  background:var(--panel);
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
}
.brand{
  display:flex;
  flex-direction:column;
  line-height:1.1;
}
.brand b{ font-size:16px; }
.brand small{ opacity:0.7; font-weight:600; }
.topbar .right{
  display:flex;
  gap:8px;
}
.topbar .right button{
  padding:10px 12px;
  border-radius:12px;
  background:var(--card);
  color:var(--text);
  border:1px solid var(--border);
}
.topbar .right button:hover{ transform: translateY(-1px); }

.modebar{
  display:flex;
  gap:8px;
  padding:10px 12px;
  background:var(--panel2);
  border-bottom:1px solid var(--border);
  overflow:auto;
}
.modebar button{
  padding:10px 12px;
  border-radius:999px;
  background:rgba(255,255,255,0.08);
  color:var(--text);
  border:1px solid var(--border);
  white-space:nowrap;
}
.light .modebar button{ background:rgba(0,0,0,0.06); }
.modebar button.active{
  background:linear-gradient(135deg, var(--btn), #1e40af);
  border-color:transparent;
}

.pages{
  flex:1;
  overflow:hidden;
  display:flex;
}

/* =========================
   CHAT PAGE
========================= */
.page{
  flex:1;
  display:none;
  flex-direction:column;
  height:100%;
}
.page.active{ display:flex; }

.chat-window{
  flex:1;
  overflow:auto;
  padding:14px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.msg{
  max-width:75%;
  padding:10px 12px;
  border-radius:14px;
  white-space:pre-wrap;
  line-height:1.4;
  font-size:14px;
}
.msg.user{ background:var(--user); color:#fff; align-self:flex-end; }
.msg.bot{ background:var(--bot); color:var(--text); align-self:flex-start; }

.input-area{
  display:flex;
  gap:10px;
  padding:12px;
  border-top:1px solid var(--border);
  background:var(--panel);
}
.input-area input{
  flex:1;
  padding:12px 14px;
  border-radius:999px;
  border:1px solid var(--border);
  background:var(--card);
  color:var(--text);
  outline:none;
}
.input-area button{
  padding:12px 16px;
  border-radius:999px;
  background:var(--btn2);
  color:#fff;
  font-weight:700;
}
.input-area button:hover{ transform: translateY(-1px); }

/* =========================
   LOGIN PAGE
========================= */
.auth-wrap{
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px;
}
.auth-card{
  width:420px;
  max-width:100%;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
}
.auth-card h2{ margin-bottom:6px; }
.auth-card p{ opacity:0.8; margin-bottom:14px; }
.auth-card input{
  width:100%;
  padding:12px 12px;
  margin:6px 0;
  border-radius:12px;
  border:1px solid var(--border);
  background:var(--card);
  color:var(--text);
  outline:none;
}
.auth-row{
  display:flex;
  gap:10px;
  margin-top:10px;
}
.auth-row button{
  flex:1;
  padding:12px;
  border-radius:12px;
  color:#fff;
  font-weight:800;
}
.btn-login{ background:var(--btn2); }
.btn-signup{ background:var(--btn); }
.btn-guest{ background:#6b7280; }
.btn-logout{ background:var(--danger); }

.note{
  margin-top:10px;
  font-size:12px;
  opacity:0.85;
}

/* =========================
   MINECRAFT MINI GAME
========================= */
.game-wrap{
  flex:1;
  overflow:auto;
  padding:14px;
}
.game-card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:16px;
  padding:14px;
}
.game-title{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  margin-bottom:10px;
}
.game-title b{ font-size:16px; }
.game-title small{ opacity:0.8; }

.mc{
  display:grid;
  grid-template-columns: repeat(10, 1fr);
  gap:6px;
  margin-top:12px;
}
.block{
  height:34px;
  border-radius:10px;
  border:1px solid var(--border);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  user-select:none;
}
.block:hover{ transform: scale(1.03); }
.dirt{ background:#6b4f2a; }
.stone{ background:#6b7280; }
.wood{ background:#7c4a2d; }
.diamond{ background:#0ea5e9; }
.empty{ background:rgba(255,255,255,0.05); }

.inv{
  margin-top:12px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.inv span{
  padding:8px 10px;
  border-radius:999px;
  background:rgba(255,255,255,0.08);
  border:1px solid var(--border);
  font-weight:700;
}
.light .inv span{ background:rgba(0,0,0,0.06); }

hr{ border:none; border-top:1px solid var(--border); margin:12px 0; }

@media (max-width: 900px){
  .sidebar{ width:240px; }
}
@media (max-width: 700px){
  .sidebar{ display:none; }
}
</style>
</head>

<body>
  <!-- =========================
       SIDEBAR
  ========================= -->
  <aside class="sidebar">
    <div class="sb-head">
      <div>
        StudyBuddy AI
        <br><small>Ultimate Hub</small>
      </div>
      <small id="sbUserTag">Guest</small>
    </div>

    <div class="sb-actions">
      <button onclick="newChat()">+ New</button>
      <button onclick="toggleTheme()">üåó</button>
    </div>

    <div class="chatlist" id="chatList"></div>

    <div class="sb-footer">
      Offline ‚Ä¢ No API ‚Ä¢ LocalStorage
    </div>
  </aside>

  <!-- =========================
       MAIN
  ========================= -->
  <main class="main">

    <div class="topbar">
      <div class="brand">
        <b id="topTitle">StudyBuddy AI</b>
        <small id="topSub">Mode: Chat</small>
      </div>

      <div class="right">
        <button onclick="exportChat()">‚¨á Export</button>
        <button onclick="resetChat()">üßπ Reset</button>
        <button onclick="logout()" id="logoutBtnTop" style="display:none;">Logout</button>
      </div>
    </div>

    <div class="modebar">
      <button id="m_chat" class="active" onclick="setMode('chat')">üí¨ Chat</button>
      <button id="m_exam" onclick="setMode('exam')">üìù Exam</button>
      <button id="m_code" onclick="setMode('code')">üíª Coding</button>
      <button id="m_math" onclick="setMode('math')">‚ûó Math</button>
      <button id="m_islam" onclick="setMode('islam')">üïå Islam</button>
      <button id="m_games" onclick="setMode('games')">üéÆ Games</button>
      <button id="m_login" onclick="showPage('auth')">üîê Login</button>
    </div>

    <div class="pages">

      <!-- CHAT PAGE -->
      <section class="page active" id="page_chat">
        <div class="chat-window" id="chatWindow"></div>
        <div class="input-area">
          <input id="userInput" placeholder="Type a message..." />
          <button onclick="send()">Send</button>
        </div>
      </section>

      <!-- AUTH PAGE -->
      <section class="page" id="page_auth">
        <div class="auth-wrap">
          <div class="auth-card">
            <h2>Login / Signup</h2>
            <p>Use email + password. (Saved offline in your browser)</p>

            <input id="authEmail" type="email" placeholder="Email" />
            <input id="authPass" type="password" placeholder="Password" />

            <div class="auth-row">
              <button class="btn-login" onclick="login()">Login</button>
              <button class="btn-signup" onclick="signup()">Sign Up</button>
            </div>

            <div class="auth-row">
              <button class="btn-guest" onclick="guestMode()">Continue as Guest</button>
              <button class="btn-logout" onclick="logout()">Logout</button>
            </div>

            <div class="note" id="authMsg"></div>
          </div>
        </div>
      </section>

      <!-- GAME PAGE -->
      <section class="page" id="page_games">
        <div class="game-wrap">
          <div class="game-card">
            <div class="game-title">
              <div>
                <b>‚õèÔ∏è Minecraft Mini (Offline)</b><br>
                <small>Click blocks to mine. Find diamonds!</small>
              </div>
              <button onclick="mcReset()" style="padding:10px 12px;border-radius:12px;background:var(--btn);color:#fff;font-weight:800;">
                New World
              </button>
            </div>

            <hr>

            <div class="mc" id="mcGrid"></div>

            <div class="inv" id="mcInv"></div>

            <hr>

            <small style="opacity:0.85">
              Tip: Diamonds are rare üíé
            </small>
          </div>
        </div>
      </section>

    </div>
  </main>

<script>
/* =========================================================
   STORAGE KEYS
========================================================= */
const KEY_USERS = "SB_USERS_V1";
const KEY_SESSION = "SB_SESSION_V1";
const KEY_CHATS = "SB_CHATS_V1";
const KEY_THEME = "SB_THEME_V1";

/* =========================================================
   GLOBAL STATE
========================================================= */
let mode = "chat";
let currentUser = null; // {email}
let chats = []; // array of {id,title,messages:[{role,text}]}
let currentChatId = null;

/* =========================================================
   ELEMENTS
========================================================= */
const chatWindow = document.getElementById("chatWindow");
const chatList = document.getElementById("chatList");
const userInput = document.getElementById("userInput");
const topSub = document.getElementById("topSub");
const sbUserTag = document.getElementById("sbUserTag");
const logoutBtnTop = document.getElementById("logoutBtnTop");

/* =========================================================
   HELPERS
========================================================= */
function uid(){
  return "c_" + Math.random().toString(16).slice(2) + "_" + Date.now();
}
function nowTitle(){
  const d = new Date();
  return "Chat " + d.toLocaleString();
}
function escapeHTML(s){
  return s.replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[m]));
}
function saveTheme(){
  localStorage.setItem(KEY_THEME, document.body.classList.contains("light") ? "light" : "dark");
}
function loadTheme(){
  const t = localStorage.getItem(KEY_THEME);
  if(t === "light") document.body.classList.add("light");
}

/* =========================================================
   AUTH SYSTEM (LOCAL)
========================================================= */
function loadUsers(){
  return JSON.parse(localStorage.getItem(KEY_USERS) || "{}");
}
function saveUsers(users){
  localStorage.setItem(KEY_USERS, JSON.stringify(users));
}
function setSession(email){
  localStorage.setItem(KEY_SESSION, JSON.stringify({email}));
}
function getSession(){
  return JSON.parse(localStorage.getItem(KEY_SESSION) || "null");
}
function clearSession(){
  localStorage.removeItem(KEY_SESSION);
}
function userKey(){
  return currentUser ? ("user:" + currentUser.email.toLowerCase()) : "guest";
}

/* =========================================================
   CHAT STORAGE PER USER
========================================================= */
function loadAllChats(){
  return JSON.parse(localStorage.getItem(KEY_CHATS) || "{}");
}
function saveAllChats(obj){
  localStorage.setItem(KEY_CHATS, JSON.stringify(obj));
}
function loadChatsForCurrentUser(){
  const all = loadAllChats();
  const k = userKey();
  chats = all[k] || [];
  if(!Array.isArray(chats)) chats = [];
}
function saveChatsForCurrentUser(){
  const all = loadAllChats();
  const k = userKey();
  all[k] = chats;
  saveAllChats(all);
}

/* =========================================================
   UI PAGES
========================================================= */
function showPage(name){
  document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
  if(name === "chat") document.getElementById("page_chat").classList.add("active");
  if(name === "auth") document.getElementById("page_auth").classList.add("active");
  if(name === "games") document.getElementById("page_games").classList.add("active");
}

/* =========================================================
   MODE SYSTEM
========================================================= */
function setMode(m){
  mode = m;

  document.querySelectorAll(".modebar button").forEach(b => b.classList.remove("active"));
  const btn = document.getElementById("m_" + m);
  if(btn) btn.classList.add("active");

  if(m === "games"){
    showPage("games");
    topSub.innerText = "Mode: Games";
    return;
  }

  showPage("chat");
  topSub.innerText = "Mode: " + m.toUpperCase();

  addBot("Mode changed to: " + m.toUpperCase());
}

/* =========================================================
   CHAT UI
========================================================= */
function renderChat(){
  chatWindow.innerHTML = "";
  const chat = chats.find(c => c.id === currentChatId);
  if(!chat) return;

  chat.messages.forEach(m => {
    const div = document.createElement("div");
    div.className = "msg " + (m.role === "user" ? "user" : "bot");
    div.innerText = m.text;
    chatWindow.appendChild(div);
  });

  chatWindow.scrollTop = chatWindow.scrollHeight;
}

function addUser(text){
  const chat = chats.find(c => c.id === currentChatId);
  if(!chat) return;
  chat.messages.push({role:"user", text});
  saveChatsForCurrentUser();
  renderChat();
}

function addBot(text){
  const chat = chats.find(c => c.id === currentChatId);
  if(!chat) return;
  chat.messages.push({role:"bot", text});
  saveChatsForCurrentUser();
  renderChat();
}

function newChat(){
  const c = {
    id: uid(),
    title: nowTitle(),
    messages: []
  };
  chats.unshift(c);
  currentChatId = c.id;
  saveChatsForCurrentUser();
  renderChatList();
  renderChat();
  addBot("Welcome to StudyBuddy AI üöÄ\nChoose a mode: Chat, Exam, Coding, Math, Islam, Games.");
}

function renderChatList(){
  chatList.innerHTML = "";
  chats.forEach(c => {
    const b = document.createElement("button");
    b.className = "chatitem";
    b.onclick = () => {
      currentChatId = c.id;
      renderChatList();
      renderChat();
    };

    const left = document.createElement("div");
    left.innerHTML = "<b>" + escapeHTML(c.title) + "</b><br><span>" + (c.messages.length + " msgs") + "</span>";

    const right = document.createElement("div");
    right.style.opacity = "0.7";
    right.style.fontWeight = "900";
    right.innerText = (c.id === currentChatId) ? "‚óè" : "";

    b.appendChild(left);
    b.appendChild(right);

    chatList.appendChild(b);
  });
}

/* =========================================================
   STUDYBUDDY AI BRAIN
========================================================= */
function aiChatResponse(q){
  const lower = q.toLowerCase().trim();

  // Basic
  if(lower === "hi" || lower === "hello" || lower.includes("hi ") || lower.includes("hello")){
    return "Hello üòä I'm StudyBuddy AI!";
  }
  if(lower.includes("how are you")){
    return "Alhamdulillah I'm good ü§ç How can I help you today?";
  }
  if(lower.includes("who are you")){
    return "I am StudyBuddy AI ‚Äî an offline study + chat assistant with modes, games, and tools.";
  }
  if(lower.includes("what can you do")){
    return "I can chat, help in exams, write code, solve math, give Islamic reminders, and you can play games like Minecraft mini.";
  }
  if(lower.includes("who made you") || lower.includes("who created you")){
    return "I was made by Yousaf (a young Muslim developer) üåü";
  }

  // Mode-based
  if(mode === "exam"){
    return "üìù Exam Mode:\nSend your question and I will answer in a short, clean exam style.";
  }
  if(mode === "code"){
    return "üíª Coding Mode:\nTell me the language (HTML/JS/Python) and what you want to build.";
  }
  if(mode === "math"){
    if(!/^[0-9+\-*/(). %]+$/.test(q)) return "‚ûó Please type only math like: 12*(5+3)";
    try{
      const ans = Function("return (" + q + ")")();
      return "Answer: " + ans;
    }catch{
      return "Math error. Try again.";
    }
  }
  if(mode === "islam"){
    const islam = [
      "üïå Reminder: Pray 5 times daily.",
      "ü§≤ Dua: Allahumma zidni ilma.",
      "üìñ Quran is guidance for all mankind.",
      "ü§ç Say: Alhamdulillah for everything."
    ];
    return islam[Math.floor(Math.random()*islam.length)];
  }

  // Default
  return "Tell me more ü§î (Try: what can you do?)";
}

/* =========================================================
   SEND MESSAGE
========================================================= */
function send(){
  const text = userInput.value.trim();
  if(!text) return;
  userInput.value = "";

  addUser(text);

  // typing effect
  setTimeout(() => {
    const reply = aiChatResponse(text);
    addBot(reply);
  }, 400 + Math.random()*400);
}

userInput.addEventListener("keydown", (e)=>{
  if(e.key === "Enter") send();
});

/* =========================================================
   EXPORT + RESET
========================================================= */
function exportChat(){
  const chat = chats.find(c => c.id === currentChatId);
  if(!chat) return;

  const lines = chat.messages.map(m => (m.role === "user" ? "User: " : "AI: ") + m.text);
  const blob = new Blob([lines.join("\n\n")], {type:"text/plain"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "StudyBuddyChat.txt";
  a.click();
}

function resetChat(){
  const chat = chats.find(c => c.id === currentChatId);
  if(!chat) return;
  chat.messages = [];
  saveChatsForCurrentUser();
  renderChat();
  addBot("Chat cleared ‚úÖ");
}

/* =========================================================
   THEME
========================================================= */
function toggleTheme(){
  document.body.classList.toggle("light");
  saveTheme();
}

/* =========================================================
   LOGIN / SIGNUP / GUEST
========================================================= */
function authMsg(text, good=false){
  const el = document.getElementById("authMsg");
  el.style.color = good ? "#22c55e" : "#ef4444";
  el.innerText = text;
}

function signup(){
  const email = document.getElementById("authEmail").value.trim().toLowerCase();
  const pass = document.getElementById("authPass").value;

  if(!email || !pass) return authMsg("Enter email + password.");
  if(pass.length < 4) return authMsg("Password must be at least 4 characters.");

  const users = loadUsers();
  if(users[email]) return authMsg("Account already exists. Please login.");

  users[email] = {password: pass, created: Date.now()};
  saveUsers(users);

  authMsg("Account created! Now login ‚úÖ", true);
}

function login(){
  const email = document.getElementById("authEmail").value.trim().toLowerCase();
  const pass = document.getElementById("authPass").value;

  if(!email || !pass) return authMsg("Enter email + password.");

  const users = loadUsers();
  if(!users[email]) return authMsg("No account found. Please sign up first.");
  if(users[email].password !== pass) return authMsg("Wrong password.");

  currentUser = {email};
  setSession(email);

  afterLogin();
  authMsg("Login successful ‚úÖ", true);
}

function guestMode(){
  currentUser = null;
  clearSession();
  afterLogin();
}

function logout(){
  currentUser = null;
  clearSession();
  sbUserTag.innerText = "Guest";
  logoutBtnTop.style.display = "none";
  document.getElementById("m_login").innerText = "üîê Login";
  loadChatsForCurrentUser();
  if(chats.length === 0) newChat();
  renderChatList();
  showPage("chat");
  addBot("You are now in Guest mode.");
}

function afterLogin(){
  sbUserTag.innerText = currentUser ? currentUser.email.split("@")[0] : "Guest";
  logoutBtnTop.style.display = currentUser ? "inline-block" : "none";
  document.getElementById("m_login").innerText = currentUser ? "üë§ Account" : "üîê Login";

  loadChatsForCurrentUser();
  if(chats.length === 0) newChat();
  renderChatList();
  showPage("chat");

  addBot(currentUser ? ("Logged in as: " + currentUser.email + " ‚úÖ") : "Guest mode enabled ‚úÖ");
}

/* =========================================================
   MINECRAFT MINI GAME
========================================================= */
let mcWorld = [];
let mcInv = {dirt:0, stone:0, wood:0, diamond:0};

function mcRandomBlock(){
  const r = Math.random();
  if(r < 0.50) return "dirt";
  if(r < 0.80) return "stone";
  if(r < 0.95) return "wood";
  return "diamond"; // rare
}

function mcEmoji(type){
  if(type === "dirt") return "üü´";
  if(type === "stone") return "‚¨ú";
  if(type === "wood") return "üü§";
  if(type === "diamond") return "üíé";
  return "";
}

function mcRender(){
  const grid = document.getElementById("mcGrid");
  grid.innerHTML = "";

  mcWorld.forEach((b, idx) => {
    const div = document.createElement("div");
    div.className = "block " + (b.type || "empty");
    div.innerText = b.type ? mcEmoji(b.type) : "";
    div.title = b.type ? ("Mine: " + b.type) : "Empty";

    div.onclick = () => {
      if(!b.type) return;
      mcInv[b.type] = (mcInv[b.type] || 0) + 1;
      b.type = null;
      mcRender();
      mcRenderInv();
    };

    grid.appendChild(div);
  });
}

function mcRenderInv(){
  const inv = document.getElementById("mcInv");
  inv.innerHTML = `
    <span>üü´ Dirt: ${mcInv.dirt}</span>
    <span>‚¨ú Stone: ${mcInv.stone}</span>
    <span>üü§ Wood: ${mcInv.wood}</span>
    <span>üíé Diamond: ${mcInv.diamond}</span>
  `;
}

function mcReset(){
  mcWorld = [];
  mcInv = {dirt:0, stone:0, wood:0, diamond:0};

  for(let i=0;i<60;i++){
    mcWorld.push({type: mcRandomBlock()});
  }
  mcRender();
  mcRenderInv();
}

/* =========================================================
   INIT
========================================================= */
function init(){
  loadTheme();

  // session
  const sess = getSession();
  if(sess && sess.email){
    currentUser = {email: sess.email};
  }

  sbUserTag.innerText = currentUser ? currentUser.email.split("@")[0] : "Guest";
  logoutBtnTop.style.display = currentUser ? "inline-block" : "none";
  document.getElementById("m_login").innerText = currentUser ? "üë§ Account" : "üîê Login";

  loadChatsForCurrentUser();
  if(chats.length === 0) newChat();
  if(!currentChatId && chats.length) currentChatId = chats[0].id;

  renderChatList();
  renderChat();

  mcReset();
}
init();
</script>
</body>
</html>
